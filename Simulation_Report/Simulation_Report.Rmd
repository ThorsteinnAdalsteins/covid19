---
title: "Forspá um fjölda tilfella og álag á Landspítali"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: flatly
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = F, message = F, fig.asp = 0.621, out.width = "100%", fig.width = 8)
```



```{r, results = "hide"}
library(tidyverse); library(cowplot); library(kableExtra); library(scales); library(gganimate)
library(lubridate); library(emmeans); library(broom); library(propagate)
theme_set(theme_classic(base_size = 12) + 
            background_grid(color.major = "grey90", 
                            color.minor = "grey95", 
                            minor = "xy", major = "xy") +
            theme(legend.position = "none"))
select <- dplyr::select
Sys.setlocale("LC_TIME", "is_IS")
```

```{r}
d <- read_csv("../Data/smit.csv") %>% 
  filter(tegund == "Samtals",
         fjoldi > 0)
preds_cumulative <- read_csv("../Data/preds_cumulative.csv")
preds_active <- read_csv("../Data/preds_active.csv")
aldur <- read_csv("../Data/aldur.csv")
simulations_cumulative <- read_csv("../Data/simulations_cumulative.csv")
simulations_active <- read_csv("../Data/simulations_active.csv")
```

# Virkt

## Greind smit

### Samtals

```{r}
preds_active  %>% 
  mutate(dags = min(d$dags) + dagar -1) %>% 
  ggplot(aes(dags, pred)) +
  geom_line() +
  geom_line(aes(y = upper), lty = 2) +
  geom_point(data = d, aes(dags, fjoldi)) +
  scale_y_continuous(breaks = pretty_breaks(8)) +
  labs(title = "Virk smit í heildina") +
  theme(axis.title = element_blank()) +
  ggsave("Myndir/Aktív/Heild/smit.png", width = 8, height = 0.621 * 8, scale = 1.5)
```

### Aldursskipt

```{r, fig.asp = 1}
simulations_active %>% 
  filter(variable == "cases") %>% 
  ggplot(aes(dags, median)) +
  geom_line() +
  geom_line(aes(y = upper), lty = 2) +
  facet_wrap("aldur", scales = "free") +
  scale_y_continuous(breaks = pretty_breaks(8)) +
  labs(title = "Virk smit eftir aldri",
       y = "Tilfelli") +
  theme(axis.title = element_blank())  +
  ggsave("Myndir/Aktív/Eftir aldri/smit.png", width = 8, height = 8, scale = 1.5)
```

## Sjúkrahúslegur

### Samtals

```{r, fig.asp = 0.621}
simulations_active %>% 
  filter(variable == "hospital") %>% 
  group_by(dags) %>% 
  summarise(median = sum(median),
            upper = sum(upper)) %>% 
  ggplot(aes(dags + 6, median)) +
  geom_smooth() +
  geom_line() +
  geom_smooth(aes(y = upper), lty = 2) +
  geom_line(aes(y = upper), lty = 2) +
  scale_y_continuous(breaks = pretty_breaks(5)) +
  labs(title = "Virkar sjúkrahúslegur í heildina",
       y = "Tilfelli") +
  theme(axis.title = element_blank())  +
  ggsave("Myndir/Aktív/Heild/sjukrahus_innlagnir.png", width = 8, height = 8, scale = 1.5)
```

### Aldursskipt

```{r, fig.asp = 1}
simulations_active %>% 
  filter(variable == "hospital") %>% 
  ggplot(aes(dags + 6, median)) +
  geom_line() +
  geom_line(aes(y = upper), lty = 2) +
  facet_wrap("aldur", scales = "free") +
  scale_y_continuous(breaks = pretty_breaks(8)) +
  labs(title = "Virkar sjúkrahúslegur eftir aldri") +
  theme(axis.title = element_blank())  +
  ggsave("Myndir/Aktív/Eftir aldri/sjukrahus_innlagnir.png", width = 8, height = 8, scale = 1.5)
```



## Alvarleg tilfelli á sjúkrahúsi

### Samtals

```{r, fig.asp = 0.621}
simulations_active %>% 
  filter(variable == "serious") %>% 
  group_by(dags) %>% 
  summarise(median = sum(median),
            upper = sum(upper)) %>% 
  ggplot(aes(dags + 10, median)) +
  geom_smooth() +
  geom_line() +
  geom_smooth(aes(y = upper), lty = 2) +
  geom_line(aes(y = upper), lty = 2) +
  scale_y_continuous(breaks = pretty_breaks(5)) +
  labs(title = "Virk alvarleg tilfelli á sjúkrahúsi í heildina",
       y = "Tilfelli") +
  theme(axis.title = element_blank())  +
  ggsave("Myndir/Aktív/Heild/sjukrahus_alvarleg_tilfelli.png", width = 8, height = 8, scale = 1.5)
```

### Aldursskipt

```{r, fig.asp = 1}
simulations_active %>% 
  filter(variable == "serious") %>% 
  ggplot(aes(dags + 10, median)) +
  geom_line() +
  geom_line(aes(y = upper), lty = 2) +
  facet_wrap("aldur", scales = "free") +
  scale_y_continuous(breaks = pretty_breaks(5)) +
  labs(title = "Virk alvarleg tilfelli á sjúkrahúsi eftir aldri",
       y = "Tilfelli") +
  theme(axis.title = element_blank())  +
  ggsave("Myndir/Aktív/Eftir aldri/sjukrahus_alvarleg_tilfelli.png", width = 8, height = 8, scale = 1.5)
```

# Uppsafnað

## Greind smit

### Samtals

```{r}
preds_cumulative  %>% 
  mutate(dags = min(d$dags) + dagar -1) %>% 
  ggplot(aes(dags, pred)) +
  geom_line() +
  geom_line(aes(y = upper), lty = 2) +
  geom_point(data = d, aes(dags, fjoldi)) +
  scale_y_continuous(breaks = pretty_breaks(8)) +
  labs(title = "Uppsöfnuð smit í heildina") +
  theme(axis.title = element_blank()) +
  ggsave("Myndir/Uppsafnað/Heild/smit.png", width = 8, height = 0.621 * 8, scale = 1.5)
```

### Aldursskipt

```{r, fig.asp = 1}
simulations_cumulative %>% 
  filter(variable == "cases") %>% 
  ggplot(aes(dags, median)) +
  geom_line() +
  geom_line(aes(y = upper), lty = 2) +
  facet_wrap("aldur", scales = "free") +
  scale_y_continuous(breaks = pretty_breaks(8)) +
  labs(title = "Uppsöfnuð tilfelli eftir aldri",
       y = "Tilfelli") +
  theme(axis.title = element_blank())  +
  ggsave("Myndir/Uppsafnað/Eftir aldri/smit.png", width = 8, height = 8, scale = 1.5)
```

## Sjúkrahúslegur

### Samtals

```{r, fig.asp = 0.621}
simulations_cumulative %>% 
  filter(variable == "hospital") %>% 
  group_by(dags) %>% 
  summarise(median = sum(median),
            upper = sum(upper)) %>% 
  ggplot(aes(dags + 6, median)) +
  geom_smooth() +
  geom_line() +
  geom_smooth(aes(y = upper), lty = 2) +
  geom_line(aes(y = upper), lty = 2) +
  scale_y_continuous(breaks = pretty_breaks(5)) +
  labs(title = "Uppsafnaðar sjúkrahúslegur í heildina",
       y = "Tilfelli") +
  theme(axis.title = element_blank())  +
  ggsave("Myndir/Uppsafnað/Heild/sjukrahus_innlagnir.png", width = 8, height = 8, scale = 1.5)
```

### Aldursskipt

```{r, fig.asp = 1}
simulations_cumulative %>% 
  filter(variable == "hospital") %>% 
  ggplot(aes(dags + 6, median)) +
  geom_line() +
  geom_line(aes(y = upper), lty = 2) +
  facet_wrap("aldur", scales = "free") +
  scale_y_continuous(breaks = pretty_breaks(8)) +
  labs(title = "Uppsafnaðar sjúkrahúslegur eftir aldri") +
  theme(axis.title = element_blank())  +
  ggsave("Myndir/Uppsafnað/Eftir aldri/sjukrahus_innlagnir.png", width = 8, height = 8, scale = 1.5)
```



## Alvarleg tilfelli á sjúkrahúsi

### Samtals

```{r, fig.asp = 0.621}
simulations_cumulative %>% 
  filter(variable == "serious") %>% 
  group_by(dags) %>% 
  summarise(median = sum(median),
            upper = sum(upper)) %>% 
  ggplot(aes(dags + 10, median)) +
  geom_smooth() +
  geom_line() +
  geom_smooth(aes(y = upper), lty = 2) +
  geom_line(aes(y = upper), lty = 2) +
  scale_y_continuous(breaks = pretty_breaks(5)) +
  labs(title = "Uppsöfnuð alvarleg tilfelli á sjúkrahúsi í heildina",
       y = "Tilfelli") +
  theme(axis.title = element_blank())  +
  ggsave("Myndir/Uppsafnað/Heild/sjukrahus_alvarleg_tilfelli.png", width = 8, height = 8, scale = 1.5)
```

### Aldursskipt

```{r, fig.asp = 1}
simulations_cumulative %>% 
  filter(variable == "serious") %>% 
  ggplot(aes(dags + 10, median)) +
  geom_line() +
  geom_line(aes(y = upper), lty = 2) +
  facet_wrap("aldur", scales = "free") +
  scale_y_continuous(breaks = pretty_breaks(5)) +
  labs(title = "Uppsöfnuð alvarleg tilfelli á sjúkrahúsi eftir aldri",
       y = "Tilfelli") +
  theme(axis.title = element_blank())  +
  ggsave("Myndir/Uppsafnað/Eftir aldri/sjukrahus_alvarleg_tilfelli.png", width = 8, height = 8, scale = 1.5)
```


